var format_dns_name=function(el){el=YAHOO.util.Dom.get(el);var name=el.value;var domain=YAHOO.util.Dom.get("domain").value;if(name===""){return}if(!CPANEL.validate.end_of_string(name,".")){name+="."}if(!CPANEL.validate.end_of_string(name,domain+".")){name+=domain+"."}el.value=name};var VALID=[];var validate_name_collisions=function(cname){return CPANEL_CONTROLLED_DOMAINS.indexOf(cname)===-1};var reset_form=function(type){YAHOO.util.Dom.setStyle("add_"+type+"_record_button","display","block");YAHOO.util.Dom.get("add_"+type+"_record_status").innerHTML="";YAHOO.util.Dom.get(type+"_name").value="";if(type==="A"){YAHOO.util.Dom.get("A_address").value=""}if(type==="CNAME"){YAHOO.util.Dom.get("CNAME_cname").value=""}VALID[type+"_name"].clear_messages();if(type==="A"){VALID["A_address"].clear_messages()}if(type==="CNAME"){VALID["CNAME_cname"].clear_messages()}};var update_user_records_table=function(){var callback={success:function(o){YAHOO.util.Dom.get("user_records_div").innerHTML=o.responseText},failure:function(o){YAHOO.util.Dom.get("user_records_div").innerHTML='<div style="padding: 20px">'+CPANEL.icons.error+" "+LOCALE.maketext("AJAX Error")+": "+LOCALE.maketext("Please refresh the page and try again.")+"</div>"}};var domain=YAHOO.util.Dom.get("domain").value;YAHOO.util.Connect.asyncRequest("GET","user_zone_records.html?domain="+domain,callback,"");YAHOO.util.Dom.get("user_records_div").innerHTML='<div style="padding: 20px">'+CPANEL.icons.ajax+" "+LOCALE.maketext("Loading …")+"</div>"};var validate_unique_cname=function(input_el){var name=YAHOO.util.Dom.get(input_el).value;if(name===""){return true}var names=YAHOO.util.Dom.getElementsByClassName("zone_records_name","span","user_records_table");var types=YAHOO.util.Dom.getElementsByClassName("zone_records_type","span","user_records_table");if(names.length===0){return true}for(var i=0;i<names.length;i++){if(types[i].innerHTML.toLowerCase()!=="cname"){continue}if(names[i].innerHTML.toLowerCase()===name.toLowerCase()){return false}}return true};var add_A_record=function(){var name=YAHOO.util.Dom.get("A_name").value;var address=YAHOO.util.Dom.get("A_address").value;var api2_call={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"ZoneEdit",cpanel_jsonapi_func:"add_zone_record",domain:YAHOO.util.Dom.get("domain").value,type:"A",ttl:"14400","class":"IN",name:name,address:address};var callback={success:function(o){try{var data=YAHOO.lang.JSON.parse(o.responseText);if(data.cpanelresult.error){CPANEL.widgets.status_bar("add_A_record_status_bar","error",LOCALE.maketext("Error"),data.cpanelresult.error);reset_form("A")}else if(data.cpanelresult.data[0].result.status){CPANEL.widgets.status_bar("add_A_record_status_bar","success",LOCALE.maketext("Added Record"),name+" &rarr; "+address);reset_form("A");update_user_records_table()}else{CPANEL.widgets.status_bar("add_A_record_status_bar","error",LOCALE.maketext("Error"),data.cpanelresult.data[0].result.statusmsg);reset_form("A")}}catch(e){CPANEL.widgets.status_bar("add_A_record_status_bar","error",LOCALE.maketext("Error"),LOCALE.maketext("JSON parse failed."));reset_form("A");update_user_records_table()}},failure:function(o){YAHOO.util.Dom.setStyle("add_A_record_button","display","block");YAHOO.util.Dom.get("add_A_record_status").innerHTML="";CPANEL.widgets.status_bar("add_A_record_status_bar","error",LOCALE.maketext("AJAX Error"),LOCALE.maketext("Please refresh the page and try again."))}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(api2_call),callback,"");YAHOO.util.Dom.setStyle("add_A_record_button","display","none");YAHOO.util.Dom.get("add_A_record_status").innerHTML=CPANEL.icons.ajax+" "+LOCALE.maketext("Adding record …")};var add_CNAME_record=function(){var name=YAHOO.util.Dom.get("CNAME_name").value;var cname=YAHOO.util.Dom.get("CNAME_cname").value;var api2_call={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"ZoneEdit",cpanel_jsonapi_func:"add_zone_record",domain:YAHOO.util.Dom.get("domain").value,ttl:"14400","class":"IN",type:"CNAME",name:name,cname:cname};var callback={success:function(o){try{var data=YAHOO.lang.JSON.parse(o.responseText);if(data.cpanelresult.error){CPANEL.widgets.status_bar("add_CNAME_status_bar","error",LOCALE.maketext("Error"),data.cpanelresult.error);reset_form("CNAME")}else if(data.cpanelresult.data[0].result.status){CPANEL.widgets.status_bar("add_CNAME_status_bar","success",LOCALE.maketext("Added Record"),name+" &rarr; "+cname);reset_form("CNAME");update_user_records_table()}else{CPANEL.widgets.status_bar("add_CNAME_status_bar","error",LOCALE.maketext("Error"),data.cpanelresult.data[0].result.statusmsg);reset_form("CNAME")}}catch(e){CPANEL.widgets.status_bar("add_CNAME_status_bar","error",LOCALE.maketext("Error"),LOCALE.maketext("JSON parse failed."));reset_form("CNAME");update_user_records_table()}},failure:function(o){YAHOO.util.Dom.setStyle("add_CNAME_record_button","display","block");YAHOO.util.Dom.get("add_CNAME_record_status").innerHTML="";CPANEL.widgets.status_bar("add_CNAME_status_bar","error",LOCALE.maketext("AJAX Error"),LOCALE.maketext("Please refresh the page and try again."))}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(api2_call),callback,"");YAHOO.util.Dom.setStyle("add_CNAME_record_button","display","none");YAHOO.util.Dom.get("add_CNAME_record_status").innerHTML=CPANEL.icons.ajax+" "+LOCALE.maketext("Adding record …")};var toggle_confirm_delete=function(line){CPANEL.animate.slide_toggle("delete_confirm_"+line)};var delete_line=function(line){var api2_call={cpanel_jsonapi_version:2,cpanel_jsonapi_module:"ZoneEdit",cpanel_jsonapi_func:"remove_zone_record",domain:YAHOO.util.Dom.get("domain").value,line:line};var callback={success:function(o){try{var data=YAHOO.lang.JSON.parse(o.responseText);if(data.cpanelresult.error){YAHOO.util.Dom.setStyle("delete_input_"+line,"display","block");YAHOO.util.Dom.get("delete_status_"+line).innerHTML="";CPANEL.widgets.status_bar("delete_status_bar_"+line,"error",LOCALE.maketext("Error"),data.cpanelresult.error)}else if(data.cpanelresult.data[0].result.status){CPANEL.animate.fade_out("info_row_"+line,function(){var records_showing=false;var records=YAHOO.util.Dom.getElementsByClassName("dt_info_row","tr","user_records_table");for(var i=0;i<records.length;i++){if(YAHOO.util.Dom.getStyle(records[i],"display")!=="none"){records_showing=true}}if(!records_showing){update_user_records_table()}});CPANEL.animate.fade_out("module_row_"+line);update_user_records_table()}else{YAHOO.util.Dom.setStyle("delete_input_"+line,"display","block");YAHOO.util.Dom.get("delete_status_"+line).innerHTML="";CPANEL.widgets.status_bar("delete_status_bar_"+line,"error",LOCALE.maketext("Error"),data.cpanelresult.data[0].result.statusmsg);update_user_records_table()}}catch(e){YAHOO.util.Dom.setStyle("delete_input_"+line,"display","block");YAHOO.util.Dom.get("delete_status_"+line).innerHTML="";CPANEL.widgets.status_bar("delete_status_bar_"+line,"error",LOCALE.maketext("Error"),LOCALE.maketext("JSON parse failed."))}},failure:function(o){YAHOO.util.Dom.setStyle("delete_input_"+line,"display","block");YAHOO.util.Dom.get("delete_status_"+line).innerHTML="";CPANEL.widgets.status_bar("delete_status_bar_"+line,"error",LOCALE.maketext("AJAX Error"),LOCALE.maketext("Please refresh the page and try again."))}};YAHOO.util.Connect.asyncRequest("GET",CPANEL.urls.json_api(api2_call),callback,"");YAHOO.util.Dom.setStyle("delete_input_"+line,"display","none");YAHOO.util.Dom.get("delete_status_"+line).innerHTML=CPANEL.icons.ajax+" "+LOCALE.maketext("Deleting record …")};var add_validation=function(){VALID["A_name"]=new CPANEL.validate.validator("A Name");VALID["A_name"].add("A_name","zone_name",LOCALE.maketext("That is not a valid zone name."));VALID["A_name"].add("A_name",function(){return validate_unique_cname("A_name")},LOCALE.maketext("Name matches an existing CNAME.")+"<br />"+LOCALE.maketext("All CNAMEs must be unique."));VALID["A_name"].attach();VALID["A_address"]=new CPANEL.validate.validator("A Address");VALID["A_address"].add("A_address","ip",LOCALE.maketext("Address must be an IP address."));VALID["A_address"].add("A_address","no_local_ips",LOCALE.maketext("Address cannot be a local IP address (127.0.0.1 or 0.0.0.0)."));VALID["A_address"].attach();CPANEL.validate.attach_to_form("A_submit",[VALID["A_name"],VALID["A_address"]],add_A_record);VALID["CNAME_name"]=new CPANEL.validate.validator("CNAME Name");VALID["CNAME_name"].add("CNAME_name","zone_name",LOCALE.maketext("That is not a valid zone name."));VALID["CNAME_name"].add("CNAME_name",function(){return validate_name_collisions(YAHOO.util.Dom.get("CNAME_name").value)},LOCALE.maketext("That name is reserved (already in use)."));VALID["CNAME_name"].add("CNAME_name",function(){return validate_unique_cname("CNAME_name")},LOCALE.maketext("Name matches an existing CNAME.")+"<br />"+LOCALE.maketext("All CNAMEs must be unique."));VALID["CNAME_name"].attach();VALID["CNAME_cname"]=new CPANEL.validate.validator("A Address");VALID["CNAME_cname"].add("CNAME_cname","fqdn",LOCALE.maketext("Address must be a fully-qualified domain name."));VALID["CNAME_cname"].attach();CPANEL.validate.attach_to_form("CNAME_submit",[VALID["CNAME_name"],VALID["CNAME_cname"]],add_CNAME_record)};var toggle_domain=function(){var domain=YAHOO.util.Dom.get("domain").value;if(domain==="_select_"){CPANEL.animate.slide_up("add_record_and_zone_table")}else{CPANEL.animate.slide_down("add_record_and_zone_table");DNSSEC.update_section();update_user_records_table()}reset_form("A");reset_form("CNAME")};var init_page=function(){YAHOO.util.Event.on("domain","change",toggle_domain);YAHOO.util.Event.on("toggle_A_record_description","click",function(){CPANEL.animate.slide_toggle("A_record_description")});YAHOO.util.Event.on("toggle_CNAME_record_description","click",function(){CPANEL.animate.slide_toggle("CNAME_record_description")});YAHOO.util.Event.on("toggle_A_ip_resolve","click",function(){CPANEL.animate.slide_toggle("A_ip_resolve")});YAHOO.util.Event.on("toggle_CNAME_ip_resolve","click",function(){CPANEL.animate.slide_toggle("CNAME_ip_resolve")});add_validation();YAHOO.util.Event.addListener("A_name","blur",function(){format_dns_name(this);VALID["A_name"].verify()});YAHOO.util.Event.addListener("CNAME_name","blur",function(){format_dns_name(this);VALID["CNAME_name"].verify()});CPANEL.util.catch_enter(["A_name","A_address"],"A_submit");CPANEL.util.catch_enter(["CNAME_name","CNAME_cname"],"CNAME_submit");toggle_domain();if(YAHOO.util.Dom.get("domain").value!=="_select_"){DNSSEC.update_section();update_user_records_table()}};YAHOO.util.Event.onDOMReady(init_page);(function(){var _stylesheet=[["div.dt_module","display:none"]];var first_stylesheet=document.styleSheets[0];if("insertRule"in first_stylesheet){_stylesheet.forEach(function(rule){first_stylesheet.insertRule(rule[0]+" {"+rule[1]+"}",0)})}else{_stylesheet.forEach(function(rule){first_stylesheet.addRule(rule[0],rule[1],0)})}})();