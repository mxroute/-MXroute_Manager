define("app/services/backupAPI",["angular","cjt/io/uapi-request","cjt/services/APIService"],function(e,t){var r;try{r=e.module("App")}catch(n){r=e.module("App",[])}r.factory("backupAPIService",["APIService",function(r){var n=function(){};return n.prototype=new r,e.extend(n.prototype,{listDirectory:function(e){var r=new t.Class;r.initialize("Restore","directory_listing"),r.addArgument("path",e);var n=this.deferred(r,{transformAPISuccess:function(e){return e.data},transformAPIFailure:function(e){return e.error}});return n.promise},listFileBackups:function(e){var r=new t.Class;r.initialize("Restore","query_file_info"),r.addArgument("fullpath",e);var n=this.deferred(r,{transformAPISuccess:function(e){return e.data},transformAPIFailure:function(e){return e.error}});return n.promise},restore:function(e,r){var n=new t.Class;n.initialize("Restore","restore_file"),n.addArgument("backupID",r),n.addArgument("fullpath",e),n.addArgument("overwrite",1);var a=this.deferred(n,{transformAPISuccess:function(e){return e.data},transformAPIFailure:function(e){return e.error}});return a.promise}}),new n}])}),define("app/filters/fileSizeFilter",["angular","cjt/util/locale"],function(e,t){var r;try{r=e.module("App")}catch(n){r=e.module("App",[])}r.filter("convertedSize",function(){return function(e){return t.format_bytes(e)}})}),define("app/views/list",["angular","lodash","cjt/util/locale","app/services/backupAPI","uiBootstrap"],function(e,t,r){var n=e.module("App");n.controller("restoreModalController",["$scope","$uibModalInstance","fileExists",function(e,t,r){e.fileExists=r,e.closeModal=function(){t.close()},e.runIt=function(){t.close(!0)}}]);var a=n.controller("listController",["$scope","growl","backupAPIService","$uibModal",function(e,n,a,i){e.buildBreadcrumb=function(){if(e.directoryBreadcrumb=[],"/"===e.currentPath)e.directoryBreadcrumb=[{folder:e.currentPath,path:e.currentPath}];else for(var t=e.currentPath.split("/"),r=0,n=t.length;n>r;r++)e.directoryBreadcrumb.push({folder:t[r],path:e.currentPath.split(t[r])[0]+t[r]})},e.changeDirectory=function(t){e.loadingData=!0,e.fileBackupList=[],".."===t&&(t=e.directoryBreadcrumb[e.directoryBreadcrumb.length-3].path),"/"!==t.charAt(t.length-1)&&(t+="/"),a.listDirectory(t).then(function(r){e.currentPath=t,e.buildBreadcrumb(),e.addPaths(r),e.loadingData=!1},function(t){n.error(t),e.loadingData=!1})},e.selectItem=function(t){-1!==t.type.indexOf("dir")?e.changeDirectory(t.fullPath):(e.selectedItemName=t.parsedName,e.selectedItemExists=t.exists,e.loadingData=!0,a.listFileBackups(t.fullPath).then(function(t){e.fileBackupList=t,e.loadingData=!1},function(t){n.error(t),e.loadingData=!1}))},e.addPaths=function(t){e.currentDirectoryContent=[];for(var r=0,n=t.length;n>r;r++)t[r].path=e.currentPath,t[r].fullPath=e.currentPath+t[r].name,t[r].parsedName=t[r].name.replace(/\s/g," "),e.currentDirectoryContent.push(t[r])},e.restore=function(o){e.selectedFilePath=o.fullpath,e.selectedBackupID=o.backupID;var c=i.open({templateUrl:"restoreModalContent.tmpl",controller:"restoreModalController",resolve:{fileExists:e.selectedItemExists}});c.result.then(function(i){i&&(e.dataRestoring=!0,a.restore(e.selectedFilePath,e.selectedBackupID).then(function(a){a.success&&(e.dataRestoring=!1,n.success(r.maketext("File “[_1]” restored successfully.",t.escape(e.selectedFilePath))))},function(a){e.dataRestoring=!1,n.error(r.maketext("Restoration failure for file “[_1]”: “[_2]”.",t.escape(e.selectedFilePath),a))}))})},e.init=function(){e.currentPath="/",e.initialDataLoaded=!1,a.listDirectory(e.currentPath).then(function(t){e.buildBreadcrumb(),e.addPaths(t),e.initialDataLoaded=!0},function(t){n.error(t),e.initialDataLoaded=!0})},e.init()}]);return a}),define("app/index",["angular","cjt/core","cjt/modules","ngRoute","uiBootstrap"],function(e,t){return function(){e.module("App",["ngRoute","ui.bootstrap","cjt2.cpanel"]);var r=require(["cjt/bootstrap","cjt/views/applicationController","app/services/backupAPI","app/filters/fileSizeFilter","app/views/list"],function(r){var n=e.module("App");n.config(["$routeProvider",function(e){e.when("/list/",{controller:"listController",templateUrl:t.buildFullPath("backup_restoration/views/list.ptt")}),e.otherwise({redirectTo:"/list/"})}]),r()});return r}});