define("app/services/configService",["angular","cjt/io/api","cjt/io/uapi-request","cjt/io/uapi","cjt/services/APIService"],function(e,t,o){function n(e){var t=[];if(e.status){for(var o=e.data,n=0,a=o.length;a>n;n++){var i=o[n];t.push(i)}var s=e.meta,r=s.paginate.total_records||o.length,l=s.paginate.total_pages||1;return{items:t,totalItems:r,totalPages:l}}return{items:[],totalItems:0,totalPages:0}}var a=e.module("App");a.factory("configService",["$q","APIService",function(e,a){return{applyDomainSetting:function(a,i){var s=e.defer(),r=new o.Class;return r.initialize("LangPHP","php_set_vhost_versions"),r.addArgument("version",a),"undefined"!=typeof i&&i.length>0&&i.forEach(function(e,t){r.addArgument("vhost-"+t,e)}),t.promise(r.getRunArguments()).done(function(e){if(e=e.parsedResponse,e.status){var t=n(e);s.resolve(t)}else s.reject(e)}),s.promise},fetchList:function(a){var i=e.defer(),s=new o.Class;return s.initialize("LangPHP","php_get_vhost_versions"),a&&(a.sortBy&&a.sortDirection&&s.addSorting(a.sortBy,a.sortDirection,a.sortType),a.currentPage&&s.addPaging(a.currentPage,a.pageSize||10),a.filterBy&&a.filterCompare&&a.filterValue&&s.addFilter(a.filterBy,a.filterCompare,a.filterValue)),t.promise(s.getRunArguments()).done(function(e){if(e=e.parsedResponse,e.status){var t=n(e);i.resolve(t)}else i.reject(e.error)}),i.promise},fetchImpactedDomains:function(e,t){var n=new o.Class,i=new a;n.initialize("LangPHP","php_get_impacted_domains"),n.addArgument(e,t);var s=i.deferred(n);return s.promise},prepareList:function(e){return n(e)}}}])}),define("app/views/impactedDomainsPopup",["angular","lodash","cjt/util/locale","uiBootstrap"],function(e){var t=e.module("App"),o=t.controller("impactedDomainsPopup",["$scope","$uibModalInstance","data",function(e,t,o){e.modalData={};var n=o;e.modalData=n,e.closeModal=function(){t.close()}}]);return o}),define("app/views/config",["angular","cjt/util/locale","lodash","uiBootstrap","cjt/decorators/growlDecorator","app/services/configService","app/views/impactedDomainsPopup"],function(e,t,o){var n=e.module("App"),a=n.controller("config",["$scope","configService","$uibModal","$timeout","alertService","growl","growlMessages",function(n,a,i,s,r,l,c){n.loadingVhostList=!1,n.phpVersionsEmpty=!0,n.selectedVersion="",n.phpVhostList=[],n.vhostSelected=!1;var p=[];n.totalSelectedDomains=0,n.checkdropdownOpen=!1,n.meta={sortReverse:!1,sortBy:"vhost",sortDirection:"asc",filterBy:"*",filterCompare:"contains",filterValue:"",maxPages:0,totalItems:n.phpVhostList.length,currentPage:1,pageSize:10,pageSizes:[10,20,50,100],start:0,limit:10};var d={loading:!1,warn:!1,show:!1,showMore:!1,text:""};n.selectAllVhosts=function(){if(n.allRowsSelected)n.phpVhostList.forEach(function(e){e.rowSelected=!0,-1===p.indexOf(e.vhost)&&p.push(e.vhost)});else{var e=n.phpVhostList.map(function(e){return e.rowSelected=!1,e.vhost});p=o.difference(p,e)}n.totalSelectedDomains=p.length,n.vhostSelected=n.totalSelectedDomains>0};var u=function(e,n){n?(e.impactedDomains.loading=!0,a.fetchImpactedDomains("domain",e.vhost).then(function(n){var a=o.without(n.data.domains,e.vhost);n.status&&a.length>0&&(e.impactedDomains.show=e.impactedDomains.warn=e.rowSelected,e.impactedDomains.showMore=a.length>10,e.impactedDomains.text=t.maketext("A change to the “[output,strong,_1]” domain‘s PHP version affects the following domains:",e.vhost),e.impactedDomains.domains=o.sortBy(a))},function(e){l.error(e)}).finally(function(){e.impactedDomains.loading=!1})):e.impactedDomains.show=e.impactedDomains.warn=n};n.selectVhost=function(e){"undefined"!=typeof e&&(u(e,e.rowSelected),e.rowSelected?(p.push(e.vhost),n.allRowsSelected=n.phpVhostList.every(function(e){return e.rowSelected})):(p=p.filter(function(t){return t!==e.vhost}),n.allRowsSelected=!1)),n.totalSelectedDomains=p.length,n.vhostSelected=n.totalSelectedDomains>0},n.rowClass=function(e){return e.impactedDomains.warn?"warning":e.impactedDomains.loading?"processing":void 0},n.showAllImpactedDomains=function(e){i.open({templateUrl:"impactedDomainsPopup.ptt",controller:"impactedDomainsPopup",resolve:{data:function(){return e}}})},n.clearAllSelections=function(e){e.preventDefault(),e.stopPropagation(),p=[],n.phpVhostList.forEach(function(e){e.rowSelected=!1}),n.checkdropdownOpen=!1,n.allRowsSelected=!1,n.totalSelectedDomains=0,n.vhostSelected=!1},n.selectPage=function(t){return t&&e.isNumber(t)&&(n.meta.currentPage=t),m()},n.applyDomainPhp=function(){return c.destroyAllMessages(),r.clear(),a.applyDomainSetting(n.selectedVersion,p).then(function(e){"undefined"!=typeof e&&(l.success(t.maketext("Successfully applied [asis,PHP] version “[_1]” to the selected [numerate,_2,domain,domains].",n.selectedVersion,p.length)),n.selectPage())},function(e){if("undefined"!=typeof e.raw){var o=e.raw.errors;if(o.length>0){var a=e.data.vhosts;o.forEach(function(e){r.add({type:"danger",message:e,id:"alertMessages",replace:!1,closeable:!0})});var i=t.maketext("For more information, check the error message at the top of the page.");if(a.length<=0){var s=t.maketext("Failed to apply [asis,PHP] version “[_1]” to the selected [numerate,_2,domain,domains].",n.selectedVersion,o.length)+" "+i;return void l.error(s)}l.success(t.maketext("Successfully applied [asis,PHP] version “[_1]” to [numerate,_2,a domain,some domains].",n.selectedVersion,a.length));var c=t.maketext("Failed to apply [asis,PHP] version “[_1]” to [numerate,_2,a domain,some domains].",n.selectedVersion,o.length)+" "+i;l.error(c)}}else l.error(e.error)}).finally(function(){f()})};var m=function(){return n.loadingVhostList=!0,a.fetchList(n.meta).then(function(e){g(e)},function(e){l.error(e)}).then(function(){n.loadingVhostList=!1})},f=function(){h(),p=[],n.phpVhostList.forEach(function(e){e.rowSelected=!1}),n.allRowsSelected=!1,n.totalSelectedDomains=0,n.vhostSelected=!1},h=function(e){"undefined"!=typeof e&&(n.phpVersions=e,"undefined"!=typeof n.systemPhp&&""!==n.systemPhp&&n.phpVersions.push("inherit")),n.phpVersions.length>0?(n.selectedVersion=n.phpVersions[0],n.phpVersionsEmpty=!1):n.phpVersionsEmpty=!0},g=function(a){var i=a.items;n.meta.totalItems=a.totalItems;var s=i;if(n.meta.totalItems>o.min(n.meta.pageSizes)){var r=(n.meta.currentPage-1)*n.meta.pageSize;n.showPager=!0,n.meta.start=r+1,n.meta.limit=r+s.length}else n.showPager=!1,n.meta.start=0===s.length?0:1,n.meta.limit=s.length;var l=0;s.forEach(function(o){-1!==p.indexOf(o.vhost)?o.rowSelected=!0:(o.rowSelected=!1,l++),o.impactedDomains=e.copy(d),o.inherited=!1;var n=o.phpversion_source;if("undefined"!=typeof n){var a="",i="";"undefined"!=typeof n.domain?(a="domain",i=n.domain):"undefined"!=typeof n.system_default&&(a="system_default",i=t.maketext("System Default")),("domain"===a&&i!==o.vhost||"system_default"===a)&&(o.inherited=!0,o.inheritedInfo=t.maketext("This domain inherits its [asis,PHP] version “[output,em,_1]” from: [output,strong,_2]",o.version,i))}}),n.phpVhostList=s,n.allRowsSelected=s.length>0&&0===l};n.$on("$viewContentLoaded",function(){if(c.destroyAllMessages(),r.clear(),PAGE.vhostListData.status){n.loadingVhostList=!1;var e=a.prepareList(PAGE.vhostListData);g(e)}else l.error(PAGE.vhostListData.errors[0]);PAGE.systemPHPData.status?n.systemPhp=PAGE.systemPHPData.data.version:l.error(PAGE.systemPHPData.errors[0]),PAGE.versionListData.status?h(PAGE.versionListData.data.versions):l.error(PAGE.versionListData.errors[0])})}]);return a}),define("app/index",["angular","jquery","lodash","cjt/core","cjt/modules","ngRoute","uiBootstrap"],function(e,t,o,n){return function(){e.module("App",["ngRoute","ui.bootstrap","angular-growl","cjt2.cpanel"]);var t=require(["cjt/views/applicationController","app/views/config"],function(){var t=e.module("App");t.firstLoad={phpAccountList:!0},t.config(["$routeProvider","$locationProvider","growlProvider",function(e,t,o){o.globalTimeToLive({success:5e3,warning:5e3,info:5e3,error:1e4}),o.globalDisableCountDown(!0),e.when("/config/",{controller:"config",templateUrl:n.buildFullPath("multiphp_manager/views/config.html.tt"),reloadOnSearch:!1}),e.otherwise({redirectTo:"/config/"})}]),t.init=function(){var o=e.element("#content");return null!==o[0]&&e.bootstrap(o[0],["App"]),t},t.init()});return t}});