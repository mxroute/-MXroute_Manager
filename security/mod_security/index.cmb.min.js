define("app/services/modSecurityDomainService",["angular","lodash","cjt/util/locale","cjt/io/api","cjt/io/uapi-request","cjt/io/uapi","cjt/services/APIService"],function(e,t,i,a,n){var o=e.module("App");o.factory("modSecurityDomainService",["$q","APIService",function(i,a){function o(e){var i=[];if(e.data){for(var a=e.data,n=0,o=a.length;o>n;n++)i.push(a[n]);var r=e.meta,s=r.paginate.total_records||a.length,l=r.paginate.total_pages||1,c=0,d=0;if(r.hasOwnProperty("modsec"))c=r.modsec.total_enabled,d=r.modsec.total_disabled;else{var u=t.filter(a,function(e){return!!e.enabled});c=u?u.length:0,d=a.length-c}return{items:i,totalItems:s,totalPages:l,totalEnabled:c,totalDisabled:d}}return{items:[],totalItems:0,totalPages:0,totalEnabled:0,totalDisabled:0}}function r(e,t){var i=new n.Class;i.initialize("ModSecurity",e,{domains:t});var a=this.deferred(i,{done:function(e,t){e=e.parsedResponse;var i=o(e);e.status?t.resolve(i):t.reject({items:i.items,error:e.error})}});return a.promise}function s(e){var t=new n.Class;t.initialize("ModSecurity",e);var i=this.deferred(t,{done:function(e,t){e=e.parsedResponse;var i=o(e);e.status?t.resolve(i):(i.error=e.error,t.reject(i))}});return i.promise}var l=function(){};return l.prototype=new a,e.extend(l.prototype,{fetchList:function(e){var t=new n.Class;t.initialize("ModSecurity","list_domains"),e&&(e.sortBy&&e.sortDirection&&t.addSorting(e.sortBy,e.sortDirection,e.sortType),e.pageNumber&&t.addPaging(e.pageNumber,e.pageSize||10),e.filterBy&&e.filterCompare&&e.filterValue&&t.addFilter(e.filterBy,e.filterCompare,e.filterValue));var i=this.deferred(t,{transformAPISuccess:o});return i.promise},prepareList:function(e){return o(e)},enableDomains:function(e){return r.call(this,"enable_domains",e)},enableAllDomains:function(){return s.call(this,"enable_all_domains")},disableDomains:function(e){return r.call(this,"disable_domains",e)},disableAllDomains:function(){return s.call(this,"disable_all_domains")}}),new l}])}),define("app/views/domainListController",["angular","lodash","cjt/util/locale","uiBootstrap","cjt/directives/alertList","cjt/services/alertService","cjt/decorators/paginationDecorator","cjt/directives/toggleSortDirective","cjt/directives/validationItemDirective","cjt/directives/spinnerDirective","cjt/directives/autoFocus","cjt/filters/wrapFilter","cjt/filters/breakFilter","app/services/modSecurityDomainService"],function(e,t,i){var a=e.module("App"),n=function(e,t){for(var i=0,a=e.length;a>i;i++){var n=o(t,e[i].domain);n?(e[i].enabled=n.enabled,n.exception?e[i].exception=n.exception:delete e[i].exception):e[i].exception&&delete e[i].exception}},o=function(e,t){for(var i=0,a=e.length;a>i;i++)if(e[i].domain===t)return e[i]},r=function(e,t){t&&(t.exception?e.exception=t.exception:e.exception&&delete e.exception)},s=function(e,t){for(var i=0,a=e.length;a>i;++i)if(t(e[i]))return i;return-1},l=function(e,t){return s(e,function(e){return t===e.domain})},c=function(e,t){if(e&&e.length>0){var i=l(e,t);-1!==i&&e.splice(i,1)}},d=function(e,t,i){var a=l(e,t),n={domain:t,exception:i};-1!==a?e.splice(a,1,n):e.push(n)},u=function(i,a){return a&&0!==a.length?(e.forEach(i,function(e){var i=t.find(a,function(t){return e.domain===t.domain});r(e,i)}),i):i},m=a.controller("domainListController",["$scope","$routeParams","$q","modSecurityDomainService","spinnerAPI","alertService",function(o,r,s,l,m,f){var p=function(){o.activeSearch=!1,o.filteredData=!1,o.totalEnabled=0,o.totalDisabled=0,o.selectedRow=-1,o.alerts=f.getAlerts(),o.hasIssues=!1,o.issues=[],o.openConfirmation=null,o.isInstalled=PAGE.installed,o.hasFeature=PAGE.hasFeature,o.hasFeature&&(o.domainList=[],o.totalPages=0,o.totalItems=0,o.meta={filterBy:r.filterBy||"*",filterCompare:r.filterCompare||"contains",filterValue:r.filterValue||"",pageSize:r.pageSize||10,pageNumber:r.pageNumber||1,sortDirection:r.sortDirection||"asc",sortBy:r.sortBy||"domain",sortType:r.sortType,pageSizes:[10,20,50,100]})};o.clearFilter=function(){return o.meta.filterValue="",o.activeSearch=!1,o.filteredData=!1,o.selectedRow=-1,o.fetch()},o.startFilter=function(){o.activeSearch=!0,o.filteredData=!1,o.selectedRow=-1;var e=s.defer();e.promise.then(function(){o.selectPage(1)}).then(function(){o.filteredData=!0}),e.resolve()},o.toggleRow=function(e,t){e.preventDefault(),o.selectedRow=t===o.selectedRow?-1:t},o.selectPage=function(t){return o.selectedRow=-1,t&&e.isNumber(t)&&(o.meta.pageNumber=t),o.fetch()},o.sortList=function(e,t){o.selectedRow=-1,t||o.fetch()},o.triggerToggleSearch=function(e){27===e.keyCode&&o.toggleSearch(!0),13===e.keyCode&&o.toggleSearch()},o.toggleSearch=function(e){var t=o.meta.filterValue;t||!o.activeSearch&&!o.filteredData?e&&o.activeSearch?o.clearFilter():t&&o.startFilter():o.clearFilter()},o.fetch=function(){return m.start("loadingSpinner"),l.fetchList(o.meta).then(function(e){o.domainList=u(e.items,o.issues),o.totalItems=e.totalItems,o.totalPages=e.totalPages,o.totalEnabled=e.totalEnabled,o.totalDisabled=e.totalDisabled},function(e){f.add({type:"danger",message:e,id:"fetchError"})}).then(function(){m.stop("loadingSpinner")})},o.setDomain=function(t){return m.start("loadingSpinner"),t.enabled?l.enableDomains(t.domain).then(function(e){o.totalEnabled++,o.totalDisabled--,c(o.issues,t.domain),t.exception&&delete t.exception,g(),f.add({type:"success",message:i.maketext("Successfully enabled [asis,ModSecurity™] on “[_1]”.",e.items[0].domain),id:"enableSuccess"})},function(i){var a;if(e.isString(i))a=i;else{var n=i.items[0].exception,r=i.items[0].enabled;d(o.issues,t.domain,n),t.exception=n,t.enabled=r,g(),a=i.error}f.add({type:"danger",message:a,id:"enableFailure"})}).then(function(){m.stop("loadingSpinner")}):l.disableDomains(t.domain).then(function(e){o.totalDisabled++,o.totalEnabled--,c(o.issues,t.domain),t.exception&&delete t.exception,g(),f.add({type:"success",message:i.maketext("Successfully disabled [asis,ModSecurity™] on “[_1]”.",e.items[0].domain),id:"disableSuccess"})},function(i){var a;if(e.isString(i))a=i;else{var n=i.items[0].exception,r=i.items[0].enabled;d(o.issues,t.domain,n),t.exception=n,t.enabled=r,g(),a=i.error}f.add({type:"danger",message:a,id:"disableFailed"})}).then(function(){m.stop("loadingSpinner")})},o.enableAllDomains=function(t){return t.preventDefault(),m.start("loadingSpinner"),l.enableAllDomains().then(function(e){b(),n(o.domainList,e.items),o.totalItems=e.totalItems,o.totalPages=e.totalPages,o.totalEnabled=e.totalItems,o.totalDisabled=0,f.add({type:"success",message:i.maketext("Successfully enabled [asis,ModSecurity™] on all domains."),id:"enableAllSuccess"})},function(t){var i;e.isString(t)?i=t:(n(o.domainList,t.items),o.issues=t.items||[],g(),o.totalEnabled=t.totalEnabled,o.totalDisabled=t.totalDisabled,i=t.error),f.add({type:"danger",message:i,id:"enableAllFailed"})}).then(function(){m.stop("loadingSpinner")})},o.disableAllDomains=function(t){return t.preventDefault(),m.start("loadingSpinner"),l.disableAllDomains().then(function(e){n(o.domainList,e.items),o.issues=e.items||[],o.totalItems=e.totalItems,o.totalPages=e.totalPages,o.totalDisabled=e.totalItems,o.totalEnabled=0,f.add({type:"success",message:i.maketext("Successfully disabled [asis,ModSecurity™] on all domains."),id:"disableAllSuccess"})},function(t){var i;e.isString(t)?i=t:(n(o.domainList,t.items),o.issues=t.items||[],g(),o.totalEnabled=t.totalEnabled,o.totalDisabled=t.totalDisabled,i=t.error),f.add({type:"danger",message:i,id:"disableAllFailed"})}).finally(function(){m.stop("loadingSpinner"),o.openConfirmation=null})};var g=function(){var e=t.find(o.domainList,function(e){return!!e.exception});o.hasIssues="undefined"!=typeof e};o.hasIssue=function(e){return!!e.exception};var b=function(){delete o.hasIssues};o.hasDisabledDomains=function(){return o.totalDisabled>0},o.confirm=function(e){o.openConfirmation=e?e:null};var v=function(){if(a.firstLoad.domainList&&PAGE.domainList){a.firstLoad.domainList=!1;var e=l.prepareList(PAGE.domainList);o.meta.pageNumber=1,o.domainList=e.items,o.totalItems=e.totalItems,o.totalPages=e.totalPages,o.totalEnabled=PAGE.domainList.meta.modsec.total_enabled,o.totalDisabled=PAGE.domainList.meta.modsec.total_disabled}else o.selectPage(1)};p(),o.$watch("meta.filterValue",function(e,t){e!==t&&(o.activeSearch=!1)}),o.$watch("meta.pageSize",function(e,t){e!==t&&o.selectPage(1)}),v()}]);return m}),define("app/index",["angular","jquery","lodash","cjt/core","cjt/modules","ngRoute","uiBootstrap"],function(e,t,i,a){return function(){e.module("App",["ngRoute","ui.bootstrap","cjt2.cpanel"]);var t=require(["cjt/views/applicationController","app/views/domainListController"],function(){var t=e.module("App");t.firstLoad={domainList:!0},t.config(["$routeProvider",function(e){e.when("/domainList/",{controller:"domainListController",templateUrl:a.buildFullPath("security/mod_security/views/domainListView.ptt")}),e.otherwise({redirectTo:"/domainList/"})}]),t.init=function(){var i=e.element("#content");return null!==i[0]&&e.bootstrap(i[0],["App"]),t},t.init()});return t}});